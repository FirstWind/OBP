{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/schemas/appendix12.schema.json",
  "type": "object",
  "required": ["scales", "adjustments"],
  "additionalProperties": false,
  "properties": {
    "scales": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/scale" }
    },
    "adjustments": {
      "type": "object",
      "required": ["rules", "max_adjustments_per_result"],
      "additionalProperties": false,
      "properties": {
        "rules": {
          "type": "array",
          "items": { "$ref": "#/$defs/adjustmentRule" }
        },
        "max_adjustments_per_result": { "type": "integer", "minimum": 0, "maximum": 5 }
      }
    }
  },
  "$defs": {
    "scale": {
      "type": "object",
      "required": ["scale_id", "exercise_id", "sex", "age_group", "variant", "result_type", "unit", "better_is", "rows"],
      "additionalProperties": false,
      "properties": {
        "scale_id": { "type": "string", "minLength": 1 },
        "exercise_id": { "type": "integer", "minimum": 1 },
        "sex": { "type": "string", "enum": ["M", "F"] },
        "age_group": { "type": "integer", "minimum": 1, "maximum": 8 },
        "variant": { "type": "string", "minLength": 1 },
        "result_type": { "type": "string", "enum": ["time", "reps", "distance", "score", "mixed"] },
        "unit": { "type": "string", "minLength": 1 },
        "better_is": { "type": "string", "enum": ["lower", "higher"] },
        "rows": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/scaleRow" }
        }
      }
    },
    "scaleRow": {
      "type": "object",
      "additionalProperties": false,
      "oneOf": [
        {
          "required": ["result_lte", "points"],
          "properties": {
            "result_lte": { "type": "number" },
            "points": { "type": "integer", "minimum": 0, "maximum": 100 }
          }
        },
        {
          "required": ["result_gte", "points"],
          "properties": {
            "result_gte": { "type": "number" },
            "points": { "type": "integer", "minimum": 0, "maximum": 100 }
          }
        },
        {
          "required": ["result_exact", "points"],
          "properties": {
            "result_exact": { "type": "number" },
            "points": { "type": "integer", "minimum": 0, "maximum": 100 }
          }
        },
        {
          "required": ["result_from", "result_to", "points"],
          "properties": {
            "result_from": { "type": "number" },
            "result_to": { "type": "number" },
            "points": { "type": "integer", "minimum": 0, "maximum": 100 }
          }
        }
      ]
    },
    "adjustmentRule": {
      "type": "object",
      "required": ["adjustment_id", "applies_to", "description", "effect"],
      "additionalProperties": false,
      "properties": {
        "adjustment_id": { "type": "string", "minLength": 1 },
        "applies_to": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "enum": ["time", "distance", "reps", "score", "mixed"] }
        },
        "description": { "type": "string", "minLength": 1 },
        "effect": { "$ref": "#/$defs/effect" }
      }
    },
    "effect": {
      "type": "object",
      "required": ["type", "value"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["delta_seconds", "delta_meters", "delta_reps", "multiplier"]
        },
        "value": { "type": "number" }
      }
    }
  }
}
