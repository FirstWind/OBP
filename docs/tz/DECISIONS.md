# Зафиксированные решения (v1)

## Платформа и режим
- Только LAN режим через Firebird Server 3.x (embedded режим не используется).
- При потере соединения с сервером UI переходит в read-only:
  - блокируется ввод;
  - показывается статус “Соединение потеряно”;
  - локальный кэш не используется.
  - режим включается монитором соединения (пинг `SELECT 1 FROM RDB$DATABASE`).
- Параметры подключения берутся из `config/app.ini`.

## Политики (фиксируются в `policies_snapshot_json` сессии)
- `WomenCategoryPolicy = force_3`.
- `ExcusedStatusPolicy` по умолчанию:
  - `no_show_valid` → `no_grade`
  - `medical_exempt` → `no_grade`
  - `lfk` → `no_grade`
- `OutOfScalePolicy` по умолчанию: `zero_points`.
- `OutOfScalePolicy = error` используется только в тестировании/валидации.
- `AdjustmentsPolicy` — поддерживается как data в Norms Pack; в v1 рекомендуется `disabled`.
- `RoundingPolicy` — по контракту Norms Pack (time_sec / distance_m / reps).
- `MissingThresholdPolicy = error`.

## Квалификационный уровень (КУ)
- Рассчитывается одновременно с итоговой оценкой.
- Источник порогов: `appendix11.json` в Norms Pack.
- КУ зависит от суммы баллов и количества выполненных упражнений (3/4/5).
- КУ не заменяет итоговую оценку, хранится отдельно.

## Возрастные группы
- Расчёт по состоянию на 31 декабря года проверки.
- Правило границ:
  - age_years < 25 → группа “до 25”
  - 25–29, 30–34, 35–39, 40–44, 45–49, 50–54, 55+ (мужчины)
  - 25–29, 30–34, 35–39, 40–44, 45+ (женщины)
- Медицинская корректировка возрастной группы:
  - хранится как `age_group_med_delta` и причина;
  - базовая группа не меняется;
  - эффективная группа используется в расчётах.

## Отчёты
- Печатные формы с предпросмотром и печатью на любой установленный принтер.
- Отдельная генерация PDF-файлов в v1 не требуется.
- Экспорт ведомостей/отчётов в XLSX обязателен.

## Person (v1-full)
- Таблица `persons` содержит полный кадровый набор полей и системные атрибуты
  (см. `docs/db/ddl_v1.sql`).

## thresholds_snapshot_json
- В `calculated_results.thresholds_snapshot_json` допускается NULL для NO_GRADE.

## Norms hash
- `norms_pack_hash` хранится как hex-строка SHA-256 длиной 64 символа без префикса.
